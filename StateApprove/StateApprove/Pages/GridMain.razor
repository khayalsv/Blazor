@page "/gridmain"

@using System.Collections.Generic;

@inject IRoleService roleService
@inject IAboutService aboutService



<div class="row">
    <div class="col-6">

        <TelerikGrid Data=@GridData EditMode="@GridEditMode.Incell"
                     Height="500px"
                     Sortable="true"
                     Pageable="true" PageSize=@PageSize OnUpdate=@UpdateItem OnDelete=@DeleteItem OnCreate=@CreateItem
                     OnRowClick="@OnRowClickHandler"
                     SelectionMode="@GridSelectionMode.Single"
                     RowDraggable="true"
             OnRowDrop="@((GridRowDropEventArgs<Role> args) => OnRowDropHandler(args))">
            <GridSettings>
                <GridRowDraggableSettings DragClueField="@nameof(Role.Name)"></GridRowDraggableSettings>
            </GridSettings>
            
            <GridToolBar>
                <GridCommandButton Command="Add" Icon="add">Add Role</GridCommandButton>
                <GridCommandButton Command="Delete" Icon="delete">Delete</GridCommandButton>

            </GridToolBar>
            <GridColumns>
                <GridColumn Field=@nameof(Role.Name) Title="Approve Stage Details Name" />
                <GridColumn Field=@nameof(Role.Sequence) Title="Sequence" />
                <GridCommandColumn Title="Action">
                    <GridCommandButton Command="Delete" Icon="delete">Delete</GridCommandButton>
                </GridCommandColumn>
            </GridColumns>
        </TelerikGrid>
    </div>


    <div class="col-6">

        <TelerikGrid Data="@selectModel?.AboutList" EditMode="@GridEditMode.Incell"
                     Height="500px"
                     Pageable="true" PageSize=@PageSize OnUpdate=@UpdateItemAbout OnDelete=@DeleteItemAbout OnCreate=@CreateItemAbout>
            <GridToolBar>
                <GridCommandButton Command="Add" Icon="add">Add About</GridCommandButton>

            </GridToolBar>
            <GridColumns>
                 <GridColumn Field=@nameof(About.Name) Title="Approve Role Name" />
                <GridColumn Field=@nameof(About.Amount) Title="Amount" />
             
                <GridCommandColumn Title="Action">
                    <GridCommandButton Command="Delete" Icon="delete">Delete</GridCommandButton>
                </GridCommandColumn>
            </GridColumns>
        </TelerikGrid>
     </div>

</div>




@code {

    int PageSize = 15;
    public List<Role>? GridData { get; set; }
    public List<About>? GridDataAbout { get; set; }
    Role? selectModel;

    protected override void OnInitialized()
    {
        LoadData();
        LoadDataAbout();
        selectModel = new Role();
    }

    private void OnRowDropHandler(GridRowDropEventArgs<Role> args)
    {
        //The data manipulations in this example are to showcase a basic scenario.
        //In your application you should implement them as per the needs of the project.

        GridData.Remove(args.Item);

        var destinationItemIndex = GridData.IndexOf(args.DestinationItem);

        if (args.DropPosition == GridRowDropPosition.After)
        {
            destinationItemIndex++;
        }

        GridData.Insert(destinationItemIndex, args.Item);


    }

    //Role

    private void LoadData()
    {
        GridData = roleService.GetRoles().ToList();

    }

    private void CreateItem(GridCommandEventArgs args)
    {
       
        roleService.CreateRole((Role)args.Item);

        LoadData();
    }

    private void DeleteItem(GridCommandEventArgs args)
    {
        roleService.DeleteRole((Role)args.Item);
        LoadData();
    }

    private void UpdateItem(GridCommandEventArgs args)
    {
        roleService.UpdateRole((Role)args.Item);
        LoadData();
    }


    //About


    private void LoadDataAbout()
    {
        GridDataAbout = aboutService.GetAbouts().ToList();
    }

    private void CreateItemAbout(GridCommandEventArgs args)
    {
        aboutService.CreateAbout((About)args.Item);
        LoadDataAbout();
    }

    private void DeleteItemAbout(GridCommandEventArgs args)
    {
        aboutService.DeleteAbout((About)args.Item);
        LoadDataAbout();
    }

    private void UpdateItemAbout(GridCommandEventArgs args)
    {
        aboutService.UpdateAbout((About)args.Item);
        LoadDataAbout();
    }

    void OnRowClickHandler(GridRowClickEventArgs args)
    {
        selectModel = args.Item as Role;
    }
}